<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Registration/Login</title>
<style>
body { font-family: Arial,sans-serif; background:#f5f5f5; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; }
.container { background:white; padding:30px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.1); width:350px; }
h2 { text-align:center; margin-bottom:20px; }
input, button { width:100%; padding:10px; margin-bottom:15px; font-size:16px; border-radius:5px; border:1px solid #ddd; }
button { background:#2196F3; color:white; border:none; cursor:pointer; }
button:hover { background:#1976D2; }
.error { color:red; text-align:center; margin-top:10px; }
.success { color:green; text-align:center; margin-top:10px; }
.tabs { display:flex; margin-bottom:20px; }
.tab { flex:1; padding:10px; text-align:center; cursor:pointer; border-bottom:2px solid transparent; }
.tab.active { border-bottom-color:#2196F3; font-weight:bold; }
</style>
</head>
<body>

<div class="container">
  <h2>Student Portal</h2>
  
  <div class="tabs">
    <div class="tab active" onclick="showTab('register')">Register</div>
    <div class="tab" onclick="showTab('login')">Login</div>
  </div>

  <!-- Registration Form -->
  <div id="registerTab">
    <form id="registerForm">
      <input type="text" id="regName" name="name" placeholder="Full Name" required>
      <input type="text" id="regID" name="id" placeholder="ID (UGR/xxxxx/xx)" required>
      <input type="password" id="regPass" name="password" placeholder="Password (min 4 characters)" required>
      <button type="submit">Register</button>
    </form>
    <div id="registerMessage"></div>
  </div>

  <!-- Login Form -->
  <div id="loginTab" style="display:none;">
    <form id="loginForm">
      <input type="text" id="loginName" name="name" placeholder="Your Name" required>
      <input type="password" id="loginPass" name="password" placeholder="Password" required>
      <button type="submit">Login</button>
    </form>
    <div id="loginMessage"></div>
  </div>

  <div style="text-align:center; margin-top:15px; font-size:14px; color:#666;">
    Test Mode: Use any credentials
  </div>
</div>

<script>
function showTab(tabName) {
  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
  document.getElementById('registerTab').style.display = 'none';
  document.getElementById('loginTab').style.display = 'none';
  
  if (tabName === 'register') {
    document.querySelector('.tab:nth-child(1)').classList.add('active');
    document.getElementById('registerTab').style.display = 'block';
  } else {
    document.querySelector('.tab:nth-child(2)').classList.add('active');
    document.getElementById('loginTab').style.display = 'block';
  }
}

// Registration form handler
document.getElementById('registerForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const name = document.getElementById('regName').value.trim();
  const id = document.getElementById('regID').value.trim();
  const password = document.getElementById('regPass').value.trim();
  
  const messageDiv = document.getElementById('registerMessage');
  
  // Basic validation
  if (!/^UGR\/\d{5}\/\d{2}$/i.test(id)) {
    showMessage(messageDiv, 'ID must be in format UGR/xxxxx/xx', 'error');
    return;
  }
  
  if (password.length < 4) {
    showMessage(messageDiv, 'Password must be at least 4 characters', 'error');
    return;
  }
  
  showMessage(messageDiv, 'Registering...', 'success');
  
  // Simulate registration (replace with actual API call later)
  setTimeout(() => {
    const student = { id, name, isLeader: false, groups: [] };
    localStorage.setItem('currentUser', JSON.stringify(student));
    showMessage(messageDiv, 'Registration successful! You can now login.', 'success');
    document.getElementById('registerForm').reset();
    showTab('login');
  }, 1000);
});

// Login form handler  
document.getElementById('loginForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const name = document.getElementById('loginName').value.trim();
  const password = document.getElementById('loginPass').value.trim();
  
  const messageDiv = document.getElementById('loginMessage');
  
  if (!name || !password) {
    showMessage(messageDiv, 'Please enter both name and password', 'error');
    return;
  }
  
  showMessage(messageDiv, 'Logging in...', 'success');
  
  // Simulate login (replace with actual API call later)
  setTimeout(() => {
    // For demo purposes, create a mock student
    const student = { 
      id: 'UGR/' + Math.random().toString().slice(2,7) + '/23', 
      name: name, 
      isLeader: false, 
      groups: [] 
    };
    localStorage.setItem('currentUser', JSON.stringify(student));
    showMessage(messageDiv, 'Login successful! Redirecting...', 'success');
    
    setTimeout(() => {
      window.location.href = 'dashboard.html';
    }, 1000);
  }, 1000);
});

function showMessage(element, message, type) {
  element.textContent = message;
  element.className = type;
}

// Test the API connection on load
window.addEventListener('load', function() {
  testAPIConnection();
});

function testAPIConnection() {
  const script = document.createElement('script');
  const callbackName = 'test_' + Date.now();
  window[callbackName] = function(data) {
    console.log('API Connection Test:', data);
    delete window[callbackName];
    document.body.removeChild(script);
    
    if (data && data.success) {
      console.log('✅ API is working correctly');
    } else {
      console.log('❌ API connection failed');
    }
  };
  
  script.src = 'https://script.google.com/macros/s/AKfycbwqQRjBdW5G5j8L_NIURaXM-xOyWiYbCLhJcA1aM4QSL1erQzy98UZxLZzKepVRRtbKXg/exec?action=test&callback=' + callbackName;
  document.body.appendChild(script);
}
</script>

</body>
</html>
